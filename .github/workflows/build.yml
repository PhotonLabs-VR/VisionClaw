cat > .github/workflows/build.yml << 'YAML'
name: Generate Certificate
on:
  workflow_dispatch:
jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Generate self-signed cert and build
        run: |
          security create-keychain -p "temp" build.keychain
          security default-keychain -s build.keychain
          security unlock-keychain -p "temp" build.keychain
          xcodebuild \
            -project samples/CameraAccess/CameraAccess.xcodeproj \
            -scheme CameraAccess \
            -sdk iphoneos \
            -configuration Debug \
            -derivedDataPath build \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_ALLOWED=NO \
            build
          mkdir -p output/Payload
          find build -name "CameraAccess.app" -type d -exec cp -r {} output/Payload/ \;
          cd output && zip -r VisionClaw.ipa Payload/
      - uses: actions/upload-artifact@v4
        with:
          name: VisionClaw
          path: output/VisionClaw.ipa
